{% extends "home.html" %}
{% load static %}

{% block content %}
<div class="container my-5">
  <h2>{{ product.name }}</h2>

  <!-- ğŸ”¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
  <div class="row mb-4">
    <div class="col-md-6">
      <img src="{% static 'images/no-image.png' %}" class="card-img-top" alt="{{ product.name }}">
    </div>
    <div class="col-md-6">
      <p>{{ product.description }}</p>
      <p><strong>ğŸ’° Ø§Ù„Ø³Ø¹Ø±:</strong> {{ product.price }} $</p>
      <p><strong>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> {{ product.average_rating|floatformat:1 }}</p>
      <p><strong>ğŸ“ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª:</strong> {{ product.reviews_count }}</p>
    </div>
  </div>

  <hr>

  <!-- ğŸ”¹ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø§Ø¬Ø¹Ø© -->
  {% if user.is_authenticated %}
    <h5>ğŸ“ Ø£Ø¶Ù Ù…Ø±Ø§Ø¬Ø¹Ø©</h5>
    <form method="post" action="{% url 'add-review' product.id %}" class="mb-4">
      {% csrf_token %}
      <div class="mb-2">
        <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</label>
        <select name="rating" class="form-select">
          {% for i in "12345" %}
            <option value="{{ i }}">{{ i }} â­</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-2">
        <label>Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:</label>
        <textarea name="review_text" class="form-control" rows="3"></textarea>
      </div>
      <button type="submit" class="btn btn-success">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
    </form>
  {% else %}
    <p><a href="{% url 'login' %}">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a> Ù„ÙƒØªØ§Ø¨Ø© Ù…Ø±Ø§Ø¬Ø¹Ø©.</p>
  {% endif %}

  <hr>

  <!-- ğŸ”¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª -->
  <h4>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª:</h4>
  {% for review in reviews %}
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">{{ review.user.username }}</h5>
        <p>â­ {{ review.rating }}<br>{{ review.review_text }}</p>

        <p class="view-count">
          <i class="fas fa-eye"></i> {{ review.views.count }}
        </p>
        
        <!-- ğŸ”¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <p class="text-muted">
          ğŸ‘ Ù…ÙÙŠØ¯: Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙÙŠØ¯Ø©: {{ review.helpful_count }}
          Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙÙŠØ¯Ø©: {{ review.unhelpful_count }}
        </p>

        <!-- ğŸ”¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ -->
        {% if user.is_authenticated %}
        <div class="d-flex gap-2 mt-2">
          <button class="btn btn-sm btn-outline-success review-interaction"
                  data-review-id="{{ review.id }}" data-helpful="true">
            ğŸ‘ Ù…ÙÙŠØ¯ (<span class="count">{{ review.likes }}</span>)
          </button>
          <button class="btn btn-sm btn-outline-danger review-interaction"
                  data-review-id="{{ review.id }}" data-helpful="false">
            ğŸ‘ ØºÙŠØ± Ù…ÙÙŠØ¯ (<span class="count">{{ review.dislikes }}</span>)
          </button>
        </div>
        {% endif %}

        <!-- ğŸ”¹ Ø²Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº -->
        {% if user.is_authenticated %}
          <form method="post" action="{% url 'report-review' review.id %}" class="mt-2">
            {% csrf_token %}
            <input type="hidden" name="reason" value="Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚">
            <button type="submit" class="btn btn-sm btn-outline-danger">ğŸš© Ø¥Ø¨Ù„Ø§Øº</button>
          </form>
        {% endif %}

        <!-- ğŸ”¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
        <div class="ms-3 mt-3">
          <h6>ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª:</h6>
          {% for comment in review.comments.all %}
            <div class="mb-1"><strong>{{ comment.user.username }}</strong>: {{ comment.text }}</div>
          {% empty %}
            <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª.</p>
          {% endfor %}

          <!-- ğŸ”¹ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ -->
          {% if user.is_authenticated %}
            <form method="post" action="{% url 'add-comment' review.id %}">
              {% csrf_token %}
              <div class="mb-2">
                <textarea name="text" class="form-control" rows="2" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ..."></textarea>
              </div>
              <button type="submit" class="btn btn-sm btn-outline-primary">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</button>
            </form>
          {% endif %}
        </div>

      </div>
    </div>
  {% empty %}
    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø¨Ø¹Ø¯.</p>
  {% endfor %}
</div>



{% endblock %}
